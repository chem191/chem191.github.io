# Appendix C: Functions {-}

## getTeensy3Time() {-}

This function comes from the RTC example.

```{Rcpp, eval = FALSE}
time_t getTeensy3Time() {
  return Teensy3Clock.get();
}
```

## setBMESamplingParameters() {-}
```{Rcpp, eval = FALSE}
void setBMESamplingParameters() {
  if (!bme.begin(0x76)) {
    return;
  }
  // Set up oversampling and filter initialization
  bme.setTemperatureOversampling(BME680_OS_8X);
  bme.setHumidityOversampling(BME680_OS_2X);
  bme.setPressureOversampling(BME680_OS_4X);
  bme.setIIRFilterSize(BME680_FILTER_SIZE_3);
  bme.setGasHeater(320, 150); // 320*C for 150 ms
}
```

## initializeBoard() {-}
```{Rcpp, eval = FALSE}
void initializeBoard() {
  pinMode(33, OUTPUT);
  digitalWrite(33, HIGH);
  setSyncProvider(getTeensy3Time);
  if (!SD.begin(chipSelect)) {
    return;
  }
  if (!card.init(SPI_HALF_SPEED, chipSelect)) {
        // don't do anything more:
        while (1) {
            blink();
            blink();
        }
    }
}
```

## pmStartMeasurement() {-}
```{Rcpp, eval = FALSE}
bool pmStartMeasurement() {
    Serial1.begin(9600);
    delay(500);
    bool pmStatus = my_hpm.stop_autosend();
    pmStatus = my_hpm.start_measurement();
}
```

## pmStopMeasurement() {-}
```{Rcpp, eval = FALSE}
bool pmStopMeasurement() {
    bool pmStatus = my_hpm.stop_measurement();
    delay(500);
    Serial1.end();
}
```

## writeFile(char filename[16]) {-}
```{Rcpp, eval = FALSE}
void writeFile(char filename[16]) {
    File dataFile = SD.open(filename, FILE_WRITE);
    if (dataFile) {
        dataFile.print(printDateTime(printDate(year(), month(), day()), printTime(hour(), minute(), second())));
        dataFile.print(printData()); dataFile.print('\t');
        dataFile.print(p25); dataFile.print('\t'); dataFile.println(p10); 
        delay(500);
        dataFile.close();
     }
     else return;
}
```

## blink() {-}
```{Rcpp, eval = FALSE}
void blink() {
    digitalWriteFast(LED_BUILTIN, HIGH);
    delay(15);
    digitalWriteFast(LED_BUILTIN, LOW);
    delay(15);
}
```

## fillDigits(int digits) {-}
```{Rcpp, eval = FALSE}
String fillDigits(int digits) {
  if (digits < 10) {
    String digitsout = "0" + String(digits);
    return digitsout;
  }
  else return digits;
}
```

## printTime(int h, int m, int s) {-}
```{Rcpp, eval = FALSE}
String printTime(int h, int m, int s) {
  return fillDigits(h) + ":" + fillDigits(m) + ":" + fillDigits(s);
}
```

## printDate(int y, int m, int d) {-}
```{Rcpp, eval = FALSE}
String printDate(int y, int m, int d) {
  return String(y) + "-" + fillDigits(m) + "-" + fillDigits(d);
}
```

## printDateTime(String d, String t) {-}
```{Rcpp, eval = FALSE}
String printDateTime(String d, String t) {
  return d + ' ' + t + '\t';
}
```

## printData() {-}
```{Rcpp, eval = FALSE}
String printData() {
  return String(bme.temperature) + '\t' + String(bme.pressure/100.0) + '\t' + String(bme.humidity) + '\t' + String(bme.gas_resistance/1000.0);
}
```

## createFileName(int y, int m, int d) {-}
```{Rcpp, eval = FALSE}
String createFileName(int y, int m, int d) {
  return String(fillDigits(y)) + String(fillDigits(m)) + String(fillDigits(d)) + deviceID + ".txt";
}
```